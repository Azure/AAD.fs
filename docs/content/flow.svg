<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="737px" preserveAspectRatio="none" style="width:1176px;height:737px;" version="1.1" viewBox="0 0 1176 737" width="1176px" zoomAndPan="magnify"><defs><filter height="300%" id="ffq9v8etzm3dj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="420.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="219.7305"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401" y="190.4199"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401" y="292.3516"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="544.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="586.5" y="96.4883"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="479.6133" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="869.5" y="161.1094"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1102.5" y="492.5254"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="149.5078" style="stroke: #000000; stroke-width: 2.0;" width="652.5" x="502" y="453.9043"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="652.5" x="502" y="559.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="84" x2="84" y1="86.4883" y2="649.7227"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="406" x2="406" y1="86.4883" y2="649.7227"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="591" x2="591" y1="86.4883" y2="649.7227"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="874.5" x2="874.5" y1="86.4883" y2="649.7227"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1107.5" x2="1107.5" y1="86.4883" y2="649.7227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="8" y="83.5352">Requesting Party (RP)</text><ellipse cx="84" cy="13" fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M84,21 L84,48 M71,29 L97,29 M84,48 L71,63 M84,48 L97,63 " fill="none" filter="url(#ffq9v8etzm3dj)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="8" y="662.2578">Requesting Party (RP)</text><ellipse cx="84" cy="675.2109" fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M84,683.2109 L84,710.2109 M71,691.2109 L97,691.2109 M84,710.2109 L71,725.2109 M84,710.2109 L97,725.2109 " fill="none" filter="url(#ffq9v8etzm3dj)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="310" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="317" y="71.5352">Authorization Server (AS)</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="310" y="648.7227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="317" y="669.2578">Authorization Server (AS)</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="512" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="519" y="71.5352">Resource Server (RS)</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="512" y="648.7227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="519" y="669.2578">Resource Server (RS)</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="805.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="812.5" y="71.5352">PartProtector (PP)</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="805.5" y="648.7227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="812.5" y="669.2578">PartProtector (PP)</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="1070.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1077.5" y="71.5352">WebPart</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="1070.5" y="648.7227"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1077.5" y="669.2578">WebPart</text><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="420.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="219.7305"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401" y="190.4199"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401" y="292.3516"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="544.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="586.5" y="96.4883"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="479.6133" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="869.5" y="161.1094"/><rect fill="#FFFFFF" filter="url(#ffq9v8etzm3dj)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1102.5" y="492.5254"/><rect fill="#EEEEEE" filter="url(#ffq9v8etzm3dj)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1161.5" x="3" y="117.1436"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1164.5" y1="117.1436" y2="117.1436"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1164.5" y1="120.1436" y2="120.1436"/><rect fill="#EEEEEE" filter="url(#ffq9v8etzm3dj)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="191" x="488.25" y="106.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="494.25" y="123.0566">RS intializes PartProtector</text><polygon fill="#A80036" points="857.5,157.1094,867.5,161.1094,857.5,165.1094,861.5,161.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="596.5" x2="863.5" y1="161.1094" y2="161.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="603.5" y="156.3672">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="616.5" y="156.3672">mkDefault</text><polygon fill="#A80036" points="422,186.4199,412,190.4199,422,194.4199,418,190.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416" x2="868.5" y1="190.4199" y2="190.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="428" y="185.6777">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="441" y="185.6777">/.well-known/openid-configuration</text><polygon fill="#A80036" points="857.5,215.7305,867.5,219.7305,857.5,223.7305,861.5,219.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="863.5" y1="219.7305" y2="219.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413" y="214.9883">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="426" y="214.9883">signing kyes, etc</text><rect fill="#EEEEEE" filter="url(#ffq9v8etzm3dj)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1161.5" x="3" y="248.3857"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1164.5" y1="248.3857" y2="248.3857"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1164.5" y1="251.3857" y2="251.3857"/><rect fill="#EEEEEE" filter="url(#ffq9v8etzm3dj)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="197" x="485.25" y="237.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="491.25" y="254.2988">RP calling Resource Server</text><polygon fill="#A80036" points="389,288.3516,399,292.3516,389,296.3516,393,292.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="395" y1="292.3516" y2="292.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="96" y="287.6094">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="109" y="287.6094">request a token specifying the RS as a scope</text><polygon fill="#A80036" points="100,317.6621,90,321.6621,100,325.6621,96,321.6621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94" x2="405" y1="321.6621" y2="321.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="106" y="316.9199">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="119" y="316.9199">token</text><polygon fill="#A80036" points="574.5,346.9727,584.5,350.9727,574.5,354.9727,578.5,350.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="580.5" y1="350.9727" y2="350.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="96" y="346.2305">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="109" y="346.2305">pass the Bearer token with a call</text><polygon fill="#A80036" points="857.5,376.2832,867.5,380.2832,857.5,384.2832,861.5,380.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="596.5" x2="863.5" y1="380.2832" y2="380.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="603.5" y="375.541">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="616.5" y="375.541">Verify(getDemand,onSuccess,onError)</text><polygon fill="#A80036" points="607.5,405.5938,597.5,409.5938,607.5,413.5938,603.5,409.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601.5" x2="868.5" y1="409.5938" y2="409.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="613.5" y="404.8516">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="626.5" y="404.8516">getDemand(HttpContext)</text><polygon fill="#A80036" points="857.5,434.9043,867.5,438.9043,857.5,442.9043,861.5,438.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="596.5" x2="863.5" y1="438.9043" y2="438.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="603.5" y="434.1621">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="616.5" y="434.1621">the demand</text><path d="M502,453.9043 L564,453.9043 L564,460.9043 L554,470.9043 L502,470.9043 L502,453.9043 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="149.5078" style="stroke: #000000; stroke-width: 2.0;" width="652.5" x="502" y="453.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="517" y="467.4727">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="305" x="579" y="466.5391">[the token is valid and the claims match the demands]</text><polygon fill="#A80036" points="1090.5,488.5254,1100.5,492.5254,1090.5,496.5254,1094.5,492.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="879.5" x2="1096.5" y1="492.5254" y2="492.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="886.5" y="487.7832">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="908.5" y="487.7832">onSuccess(JwtSecurityToken)</text><polygon fill="#A80036" points="890.5,517.8359,880.5,521.8359,890.5,525.8359,886.5,521.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="884.5" x2="1106.5" y1="521.8359" y2="521.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="896.5" y="517.0938">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="922.5" y="517.0938"/><polygon fill="#A80036" points="607.5,547.1465,597.5,551.1465,607.5,555.1465,603.5,551.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="601.5" x2="868.5" y1="551.1465" y2="551.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="613.5" y="546.4043">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="635.5" y="546.4043">Success WebPart</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="502" x2="1154.5" y1="560.1465" y2="560.1465"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="339" x="507" y="570.7813">[the token is invalid or the claims fail to meet the demands]</text><polygon fill="#A80036" points="607.5,591.4121,597.5,595.4121,607.5,599.4121,603.5,595.4121" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="601.5" x2="868.5" y1="595.4121" y2="595.4121"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="613.5" y="590.6699">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="635.5" y="590.6699">Error WebPart</text><polygon fill="#A80036" points="100,627.7227,90,631.7227,100,635.7227,96,631.7227" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94" x2="585.5" y1="631.7227" y2="631.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="106" y="626.9805">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="132" y="626.9805"/><!--MD5=[0c8f395e3caac091691fc579f7738c1a]
@startuml
autonumber
actor "Requesting Party (RP)" as RP #white
participant "Authorization Server (AS)" as AS #white
participant "Resource Server (RS)" as RS #white
participant "PartProtector (PP)" as PP #white
participant "WebPart" #white

== RS intializes PartProtector ==
activate RS 
RS -> PP : mkDefault
activate PP 
PP -> AS : /.well-known/openid-configuration
activate AS 
AS - -> PP : signing kyes, etc
deactivate AS
== RP calling Resource Server ==
activate RP
RP -> AS : request a token specifying the RS as a scope
activate AS
AS - -> RP : token
deactivate AS
RP -> RS : pass the Bearer token with a call
RS -> PP : Verify(getDemand,onSuccess,onError)
PP -> RS : getDemand(HttpContext)
RS - -> PP : the demand
alt the token is valid and the claims match the demands
PP -> WebPart : onSuccess(JwtSecurityToken)
activate WebPart
WebPart - -> PP 
deactivate WebPart
PP - -> RS : Success WebPart 
else the token is invalid or the claims fail to meet the demands
PP - -> RS : Error WebPart 
end
RS - -> RP  

@enduml

PlantUML version 1.2020.10(Sun May 17 05:35:57 EDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14+36-1461
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: CA
--></g></svg>